---
title: "Football statistics dashboard"
output:
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
runtime: shiny
---

<style>
  .center-text {
    text-align: center;
  }
</style>

<div class="center-text">
  The best interactive dashboard on the market with statistics about football in the top 5 leagues
</div>


```{r setup, include = FALSE}
library(flexdashboard) 
library(tidyverse)
library(ggrepel)
library(DT)
#knitr::opts_chunk$set(fig.width = 5)


#read the data
data1 <- read_csv(file = "data/understat_per_game.csv")
data2 <- read_csv(file = "data/understat.com.csv")

data_per_club <- data2 |> 
                 rename("league" = ...1,
                        "year" = ...2)

data_per_club <- data_per_club |> mutate(diff_Goals = scored - missed)
head(data_per_club)

data_per_game <- data1 |> 
                 rename("stadium" = h_a,
                        "exp_Goal" = xG) |>
                 mutate("stadium" = as.factor(stadium), 
                        "result" = as.factor(result), 
                        "league" = as.factor(league),
                        "pts" = as.factor(pts))


```





Team {data-icon="fa-futbol" data-orientation=rows}
==========================


Options {.sidebar}
------------------------

```{r}
library(flexdashboard)
#data-icon="fa-table"
selectInput("season", "Choose a competition:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1" 
                  ))
```


```{r}
selectInput("nation", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))


```

```{r}
selectInput("league", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))

```


tabset
-----------------------------------

### tab1 

here we can see how the player


row
---------------------------



### Final Position
```{r fig.width=1, fig.height=0.5}

valueBox(1, caption = "Placement", icon = "fa-thumbs-up")

```

### box 2
```{r fig.width=1, fig.height=1}

gauge(10, min = 0, max = 18, gaugeSectors(
  success = c(11,18), warning = c(5, 10), danger = c(0, 4)))

```
> number of matches won played at "home" and "away"

### box 2
```{r fig.width=1, fig.height=1}

gauge(8, min = 0, max = 18, gaugeSectors(
  success = c(11,18), warning = c(5, 10), danger = c(0, 4)))

```
> the most important summary statistics for the season

### box 3
```{r fig.width=1, fig.height=1}

gauge(18, min = 0, max = 38, gaugeSectors(
  success = c(80, 100), warning = c(40, 79), danger = c(0, 39)))

```
> the most important summary statistics for the season

### box 3
```{r fig.width=1, fig.height=1}

gauge(18, min = 0, max = 38, gaugeSectors(
  success = c(80, 100), warning = c(40, 79), danger = c(0, 39)))

```

> the most important summary statistics for the season

row
----------------------------------

### chart 4 

```{r}

renderPlot({data_per_club |> group_by(year, league) |>
                  summarise(avg_exp_goal = mean(xG)) |>
                  ggplot() + geom_bar(aes(x = league,
                                          y = avg_exp_goal, 
                                          fill = league), stat = "Identity") +                                                  facet_wrap(~year, nrow = 3)})

```
> the most important summary statistics for the season 
> the most important summary statistics for the season

### chart 5 

```{r}

renderPlot({data_per_club |> group_by(year, league) |>
                  summarise(avg_exp_goal = mean(xG)) |>
                  ggplot() + geom_bar(aes(x = league,
                                          y = avg_exp_goal, 
                                          fill = league), stat = "Identity") +                                                  facet_wrap(~year, nrow = 3)})

```

row {.tabset}
--------------------------

### chart 4 

```{r}

renderPlot({data_per_club |> group_by(year, league) |>
                  summarise(avg_exp_goal = mean(xG)) |>
                  ggplot() + geom_bar(aes(x = league,
                                          y = avg_exp_goal, 
                                          fill = league), stat = "Identity") +                                                  facet_wrap(~year, nrow = 3)})

```





National League {data-icon="fa-shield"}
==============================

Options {.sidebar}
------------------------

```{r}
selectInput("variable", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))
```


```{r}
selectInput("nation", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))


```

```{r}
selectInput("league", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))

```


column
----------------------------


### summary chart
```{r}



```





### table


```{r}
renderTable({
      data_per_club |> filter(year == 2017, league == input$variable) |> select(position, team, pts, )
                }, digits = 0)

```


column  {.tabset}
-------------------------------

### chart 1

```{r}


```


### chart 2

```{r}

```

Comparison across leagues {data-orientation=columns, data-icon="fa-globe"}
============================


Options {.sidebar}
------------------------

```{r}
selectInput("season", "Choose a competition:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))
```


```{r}
selectInput("nation", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))


```

```{r}
selectInput("league", "Choose a league:",
                c("Bundesliga" = "Bundesliga",
                  "Premier League" = "EPL",
                  "Serie A" = "Serie_A",
                  "La Liga" = "La_liga", 
                  "Ligue 1" = "Ligue_1"))

```




column 
---------------------------



### chart 1 

```{r, fig.height=3}
data1 <- data_per_club |> filter(year == 2019, league == "La_liga")
 
            renderPlot({ ggplot(data1, aes(missed, scored)) +
                 geom_point(aes(color = team)) +
                 ggrepel::geom_label_repel(aes(label = team), data = data1) })  


```

### chart 2

```{r}
 renderPlot({data_per_club |> 
          filter(year == 2018) |> 
          group_by(league) |>
          ggplot() + geom_line(aes(position, pts, color = league))})
```


column
-------------------------

### chart 3 

```{r}

renderPlot({data_per_game |> filter(year == 2018) |> 
                ggplot() + geom_point(aes(scored, exp_Goal)) + facet_wrap(~league)})

```






